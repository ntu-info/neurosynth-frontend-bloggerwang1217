# QA 測試計畫：Neurosynth 前端

## 目的

本文件旨在根據 `SPEC.md` 的要求，對 Neurosynth 前端應用程式進行全面的手動測試。目標是確保所有互動元件功能正常、使用者體驗流暢，並符合規格。

## 測試環境與工具

- **待測頁面**: 使用本地開發伺服器運行的 `index.html`。
- **測試工具**:
  - 瀏覽器: Google Chrome (最新版)
  - 螢幕截圖工具: Playwright (mcp) 或系統內建工具。
- **API Mocking**: 測試期間，後端 API (`/terms`, `/terms/<t1>`, `/query/<q_string>/studies`) 應處於可用狀態，或使用 Mock Server 提供符合規格的回應。

## 測試說明

請依循以下步驟執行測試：

1.  **執行測試案例**: 逐一執行「測試案例」章節中描述的每個步驟。
2.  **驗證結果**: 仔細比對「預期結果」與實際操作結果是否相符。
3.  **拍攝關鍵截圖**: 在每個關鍵互動步驟（例如：顯示建議列表、送出查詢後、出現錯誤時）都進行螢幕截圖。截圖應清晰顯示當前的 UI 狀態。
4.  **報告問題**: 若發現任何與預期不符的行為、UI 錯位、功能錯誤，請在「問題記錄」章節中詳細記錄。

---

## 測試案例

### 1. 初始頁面載入

| 測試案例 ID | 步驟 | 預期結果 | 截圖點 |
| :--- | :--- | :--- | :--- |
| **1.1** | 開啟 `index.html` 頁面。 | 1. 頁面成功載入，無控制台錯誤。<br>2. 主查詢輸入框、相關詞面板（初始隱藏）、結果清單區域均已渲染。<br>3. 顯示查詢語法提示。 | **[截圖]** 初始畫面。 |

### 2. 查詢輸入與即時建議 (主查詢欄 /terms)

| 測試案例 ID | 步驟 | 預期結果 | 截圖點 |
| :--- | :--- | :--- | :--- |
| **2.1** | 在查詢框輸入 "a"。 | 不會觸發任何 API 請求，建議列表不顯示。 | |
| **2.2** | 接著輸入 "m"，使輸入框內容為 "am"。 | 1. 等待 250ms 後，觸發對 `/terms` 的 API 請求。<br>2. 顯示建議列表，其中包含以 "am" 為前綴的詞（如 "amygdala"）。<br>3. 匹配的前綴 "am" 應高亮顯示。 | **[截圖]** 顯示建議列表。 |
| **2.3** | 在建議列表可見時，按下 `Tab` 鍵。 | 1. 輸入框內容被第一個 ghost suggestion（如 "amygdala"）補全。<br>2. 焦點仍在輸入框內，不會自動提交查詢。 | **[截圖]** `Tab` 補全後。 |
| **2.4** | 清空輸入框，重新輸入 "emotion"。按下 `↓`（向下箭頭）鍵。 | 建議列表中的第一個項目被選中（有視覺提示，如背景色變化）。 | **[截圖]** 鍵盤選中建議。 |
| **2.5** | 在選中建議項目的狀態下，按下 `Enter` 鍵。 | 1. 輸入框內容被替換為選中的詞。<br>2. **不會**提交查詢。 | |
| **2.6** | 在輸入框無任何建議列表焦點時，按下 `Enter` 鍵。 | 提交當前輸入框的內容，觸發對 `/query/.../studies` 的請求。 | |
| **2.7** | 點擊建議列表中任一詞彙旁邊的 "Copy" 按鈕。 | 1. 該詞彙被複製到剪貼簿。<br>2. 顯示 "Copied" 提示訊息。<br>3. 輸入框內容不變。 | **[截圖]** 點擊 Copy 後。 |
| **2.8** | 點擊建議列表中的任一項目（非 "Copy" 按鈕）。 | 1. 輸入框中正在輸入的詞被建議詞替換。<br>2. 詞彙後方自動加上一個空格。<br>3. 焦點返回輸入框。 | **[截圖]** 點擊建議項目後。 |

### 3. 運算子選擇器 (主查詢欄 Operator IME)

| 測試案例 ID | 步驟 | 預期結果 | 截圖點 |
| :--- | :--- | :--- | :--- |
| **3.1** | 輸入 "amygdala" 後，按下 `Space`（空格鍵）。 | 1. 出現運算子選擇器，預設顯示 "AND"。<br>2. 輸入框中 "amygdala" 後面有一個空格。 | **[截圖]** 運算子選擇器出現。 |
| **3.2** | 在選擇器出現時，按下 `↓` 鍵，再按下 `Enter` 鍵。 | 1. 選擇器中的選項變為 "OR"。<br>2. 按下 Enter 後，"OR " 被插入到輸入框中，內容變為 "amygdala OR "。<br>3. 焦點返回輸入框。 | **[截圖]** 插入 "OR" 後。 |
| **3.3** | 重複 3.1，在選擇器出現時，按下 `Esc` 鍵。 | 1. 運算子選擇器消失。<br>2. 輸入框內容維持 "amygdala "（保留空格）。 | |
| **3.4** | 重複 3.1，在選擇器出現時，不進行任何操作，直接輸入 "e"。 | 1. 運算子選擇器消失。<br>2. 輸入框內容變為 "amygdala e"。 | |

### 4. 左側單詞查詢欄與關聯詞顯示 (Left-side Term Input & Related Terms Display)

| 測試案例 ID | 步驟 | 預期結果 | 截圖點 |
| :--- | :--- | :--- | :--- |
| **4.1** | 在**左側單詞查詢框**輸入 "a"。 | 不會觸發任何 API 請求，建議列表不顯示。 | |
| **4.2** | 接著輸入 "m"，使輸入框內容為 "am"。 | 1. 等待 250ms 後，觸發對 `/terms` 的 API 請求。<br>2. 顯示建議列表，其中包含以 "am" 為前綴的詞（如 "amygdala"）。<br>3. 匹配的前綴 "am" 應高亮顯示。<br>4. 輸入框中顯示 ghost suggestion。 | **[截圖]** 左側建議列表。 |
| **4.3** | 在建議列表可見時，按下 `Tab` 鍵。 | 1. 輸入框內容被第一個 ghost suggestion（如 "amygdala"）補全。<br>2. 焦點仍在輸入框內，不會自動提交查詢。 | **[截圖]** 左側 Tab 補全後。 |
| **4.4** | 點擊建議列表中的任一項目（非 "Copy" 按鈕）。 | 1. 輸入框內容被該建議詞替換。<br>2. 觸發對 `/terms/<selected_term>` 的請求。<br>3. 關聯詞面板出現，並分為 "co_count" 和 "jaccard" 兩欄顯示結果。 | **[截圖]** 左側點擊建議後提交。 |
| **4.5** | 在**左側單詞查詢框**輸入 "amygdala"（或透過建議選取），然後按下 `Enter` 鍵。 | 1. 觸發對 `/terms/amygdala` 的請求。<br>2. 關聯詞面板出現，並分為 "co_count" 和 "jaccard" 兩欄顯示結果。 | **[截圖]** 左側 Enter 提交後。 |
| **4.6** | 將滑鼠懸停在任一關聯詞上。 | 顯示該詞的 `co_count` 和 `jaccard` 數值。 | |
| **4.7** | 點擊關聯詞旁邊的 "Copy" 按鈕。 | 1. 該詞彙被複製到剪貼簿。<br>2. 顯示 "Copied" 提示。 | |
| **4.8** | 提交一個沒有關聯詞的查詢（需後端配合返回空陣列）。 | 關聯詞面板應保持隱藏或摺疊狀態。 | |

### 5. 研究結果列表 (`/query/<q_string>/studies`)

| 測試案例 ID | 步驟 | 預期結果 | 截圖點 |
| :--- | :--- | :--- | :--- |
| **5.1** | 提交查詢 "emotion"。 | 1. 觸發對 `/query/emotion/studies` 的請求。<br>2. 結果區域顯示研究總數 (`count`) 和研究列表。<br>3. 每項結果包含標題、作者、期刊、年份。 | **[截圖]** 顯示研究結果。 |
| **5.2** | 提交一個複合查詢，如 `"emotional faces" AND (amygdala OR insula) NOT fear`。 | 1. 查詢被正確編碼並發送。<br>2. 顯示符合邏輯條件的研究結果。 | **[截圖]** 複合查詢結果。 |
| **5.3** | 若結果超過一頁（例如超過 200 筆），向下滾動頁面。 | 當滾動到接近列表底部時，自動載入下一頁的結果（Infinite Scroll）。 | |
| **5.4** | 提交一個不會有任何結果的查詢，如 "xyzabc"。 | 1. 結果區域顯示友善的提示訊息，如『找不到符合 "xyzabc" 的結果』。 | **[截圖]** 空結果畫面。 |
| **5.5** | 提交一個語法錯誤的查詢，如 `(amygdala`。 | 顯示 "Not found" 或更具體的語法錯誤提示。 | **[截圖]** 語法錯誤提示。 |

### 6. 錯誤處理與其他

| 測試案例 ID | 步驟 | 預期結果 | 截圖點 |
| :--- | :--- | :--- | :--- |
| **6.1** | （需模擬）在發出 API 請求時，伺服器返回 500 錯誤。 | 1. 在對應的 UI 區域（建議列表、關聯詞、結果區）顯示錯誤訊息。<br>2. 錯誤訊息旁應包含一個 "Retry" 按鈕。 | **[截圖]** API 錯誤與重試按鈕。 |
| **6.2** | 點擊 "Retry" 按鈕。 | 重新發送上一次失敗的 API 請求。 | |
| **6.3** | 快速連續輸入 "neuro" 和 "synth"（間隔小於 250ms）。 | 只有在輸入 "synth" 停止後 250ms，才會發出一次對 `/terms` 的請求，而不是兩次（Debounce）。 | |
| **6.4** | 快速提交兩次不同的查詢。 | 第二次查詢發出時，第一次未完成的請求應被取消（AbortController），避免舊結果覆蓋新結果。 | |

---

## 實現狀態

### 📋 當前版本（V1 - 原始版本）
以下是已完成的功能（根據 SPEC.md 實現）

### 📝 待實現版本（V2 - UPDATE-1.md 規劃）
根據用戶反饋，需要進行以下 UI/UX 改進

---

## V1 - 原始版本的實現

### 1. **主查詢欄 (/terms API)** - V1
   - ✅ 即時建議（debounce 250ms, minLength 2）
   - ✅ Ghost suggestion 在輸入框下方
   - ✅ Tab 接受 ghost suggestion（不提交）
   - ✅ Arrow keys 鍵盤導航
   - ✅ Enter 提交查詢
   - ✅ Copy 按鈕複製詞彙
   - ✅ 點擊建議項目替換並添加空格

### 2. **運算子選擇器** - V1
   - ✅ Space 後顯示運算子選擇器（inline 灰色框）
   - ✅ Arrow Up/Down 切換運算子 (space/AND/OR/NOT)
   - ✅ Enter/Tab 確認選擇
   - ✅ Esc 取消（保留空格）
   - ✅ 繼續輸入隱藏選擇器

### 3. **左側單詞查詢欄 (/terms API)** - V1
   - ✅ 即時建議（debounce 250ms, minLength 2）
   - ✅ Ghost suggestion（帶框）
   - ✅ Tab 接受 ghost suggestion
   - ✅ Arrow keys 鍵盤導航
   - ✅ 點擊建議項目提交查詢
   - ✅ Enter 提交查詢

### 4. **關聯詞面板 (/terms/<t1> API)** - V1
   - ✅ 顯示雙欄（co_count 和 jaccard 各 top-10）
   - ✅ 獨立滾動兩欄
   - ✅ Hover 顯示數值
   - ✅ Copy 按鈕複製詞彙
   - ✅ 無關聯詞時隱藏面板

### 5. **研究結果列表 (/query/<q_string>/studies API)** - V1
   - ✅ 顯示結果計數和清單
   - ✅ 每項顯示標題、作者、期刊、年份
   - ✅ 點擊展開顯示 study_id 和 contrast_id
   - ✅ 無限滾動支持
   - ✅ 虛擬化渲染（初始渲染 200 條）

### 6. **錯誤處理和快取** - V1
   - ✅ 網路錯誤顯示 toast 通知
   - ✅ Abort previous requests 避免競態
   - ✅ Debounce 250ms
   - ✅ 快取策略：terms (session), related (5min), studies (1min)

### 📝 V1 測試情況

| 模塊 | 代碼審查 | 實際測試 | 說明 |
| :--- | :--- | :--- | :--- |
| 主查詢欄功能 | ✅ 審查通過 | ⏳ 待測試 | 代碼實現了所有鍵盤和點擊交互 |
| 運算子選擇器 | ✅ 審查通過 | ⏳ 待測試 | Space/Arrow/Enter/Esc 邏輯實現 |
| 左側單詞查詢 | ✅ 審查通過 | ⏳ 待測試 | 建議和提交功能代碼實現 |
| 關聯詞面板 | ✅ 審查通過 | ⏳ 待測試 | 兩欄排序和 Copy 功能實現 |
| 研究結果列表 | ✅ 審查通過 | ⏳ 待測試 | 無限滾動和虛擬化渲染實現 |
| 錯誤處理 | ✅ 審查通過 | ⏳ 待測試 | Toast 通知和重試機制實現 |
| 快取機制 | ✅ 審查通過 | ⏳ 待測試 | TTL 快取和 AbortController 實現 |

**測試環境限制**:
- ❌ Playwright 瀏覽器安裝失敗
- ❌ 本地 HTTP 伺服器無法啟動
- ⏳ 待在真實環境中進行集成測試

---

## V2 - 改進版本（UPDATE-1.md）

### 第一輪（基礎修改）已完成

已實現功能：
- ✅ 1. Ghost Suggestion 在輸入框內（雙層設計）
- ✅ 2. 建議列表改為 Google Search 風格
- ✅ 3. Enter 提交時移除尾部空白
- ✅ 4. 運算子選擇器改為 Google Search 風格
- ✅ 5. 關聯詞面板：單欄 + 排序按鈕 + Top-K 選擇 (10/20/50)
- ✅ 6. Hover 顯示排名信息
- ✅ 7. 移除所有 Copy 按鈕

### V2 測試項目

#### 2.1 Ghost Suggestion 對齋測試
| 測試案例 ID | 步驟 | 預期結果 | 測試狀態 |
| :--- | :--- | :--- | :--- |
| **2.1.1** | 在主查詢框輸入 "am" | Ghost suggestion 應顯示在輸入框背景，與輸入的文字精確對齋 | ⏳ 待測試 |
| **2.1.2** | 檢查背景文字與輸入文字的字體大小 | 應完全相同，無視覺偏差 | ⏳ 待測試 |

#### 2.2 選擇建議後不加空格測試
| 測試案例 ID | 步驟 | 預期結果 | 測試狀態 |
| :--- | :--- | :--- | :--- |
| **2.2.1** | 在主查詢框輸入 "am"，點擊建議項 "amygdala" | 輸入框應為 "amygdala"（無尾部空格） | ⏳ 待測試 |
| **2.2.2** | 在左側單詞查詢框輸入 "am"，點擊建議項 "amygdala" | 輸入框應為 "amygdala"（無尾部空格） | ⏳ 待測試 |

#### 2.3 邏輯符選擇器重設計測試
| 測試案例 ID | 步驟 | 預期結果 | 測試狀態 |
| :--- | :--- | :--- | :--- |
| **2.3.1** | 輸入 "amygdala"，按 Space | 應出現邏輯符選擇器列表，顯示 AND / OR / NOT（不包含 space） | ⏳ 待測試 |
| **2.3.2** | 邏輯符選擇器顯示時，檢查預設選中項 | AND 應為預設選中狀態（有視覺高亮） | ⏳ 待測試 |
| **2.3.3** | 按 ↓ 鍵選擇 OR，再按 Enter | 輸入框應變為 "amygdala OR"（OR 後無空格） | ⏳ 待測試 |
| **2.3.4** | 邏輯符選擇器顯示時，檢查是否有灰色框 | 選擇器上方不應出現灰色的 ghost suggestion 框 | ⏳ 待測試 |
| **2.3.5** | 邏輯符選擇器選項貼著輸入框 | 邏輯符列表應緊貼在輸入框下方，無浮空間距 | ⏳ 待測試 |

#### 2.4 相關詞排序按鈕改英文測試
| 測試案例 ID | 步驟 | 預期結果 | 測試狀態 |
| :--- | :--- | :--- | :--- |
| **2.4.1** | 打開左側單詞查詢，查看排序按鈕 | 按鈕應顯示為 "Sort by co_count" 和 "Sort by jaccard"（英文） | ⏳ 待測試 |
| **2.4.2** | 查看 Top-K 選擇區域 | 標籤應為 "Display:" 而非 "顯示:" | ⏳ 待測試 |

#### 2.5 相關詞 Hover 顯示排名測試
| 測試案例 ID | 步驟 | 預期結果 | 測試狀態 |
| :--- | :--- | :--- | :--- |
| **2.5.1** | 提交左側查詢 "amygdala"，獲得相關詞 | 相關詞面板應顯示 | ⏳ 待測試 |
| **2.5.2** | Hover 第一個相關詞（如 "emotional"） | 應顯示 `co_count: XXX (#1 for co_count), jaccard: X.XXXX (#Y for jaccard)` 的排名信息 | ⏳ 待測試 |
| **2.5.3** | 切換 Top-K 為 20，Hover 同一詞 | 排名應基於全部相關詞，不是基於當前 Top-20 中的排名 | ⏳ 待測試 |

---

## V3 - 進一步修正（UPDATE-2.md）

### 待實現的微調

#### 🎯 第一輪（微調 - 快速完成）
1. **1. 按鈕文字改成英文**
   - 「按 co_count」→「Sort by co_count」
   - 「按 jaccard」→「Sort by jaccard」
   - 「顯示」→「Display」

2. **7. 移除邏輯符選擇器上方的灰色框**
   - 直接從 HTML 中移除 `ghostSuggestion` 元素
   - 因為 ghost suggestion 已在輸入框背景

3. **3. 選擇建議後都不加空格**
   - 主查詢和左側單詞查詢都不自動添加空格

4. **6. Ghost Input 文字精確對齋**
   - 檢查背景淺灰字與輸入框字的字體大小是否相同
   - 確保 padding、line-height 完全一致

#### 🎯 第二輪（邏輯調整）
5. **5. 選擇邏輯符後的邏輯修正**
   - 不替換掉前面的空格
   - 邏輯符後面也不加空格

6. **2. 相關詞 Hover 顯示排名**
   - 排名基於「全部相關詞」，不是「當前顯示的 Top-K」
   - 格式：`co_count: 726 (#1 for co_count)`

#### 🎯 第三輪（核心改進）
7. **4. 邏輯符選擇器完整重設計**
   - 改為只有 `[AND] [OR] [NOT]` 三個選項（無 space）
   - 預設選中 AND
   - 貼著輸入框，與建議列表樣式一致

### V3 完成標記

#### 第一輪（微調）
- [ ] 1. 按鈕文字改成英文
- [ ] 7. 移除邏輯符選擇器上方的灰色框
- [ ] 3. 選擇建議後都不加空格
- [ ] 6. Ghost Input 文字精確對齋

#### 第二輪（邏輯調整）
- [ ] 5. 選擇邏輯符後的邏輯修正
- [ ] 2. 相關詞 Hover 顯示排名

#### 第三輪（核心改進）
- [ ] 4. 邏輯符選擇器完整重設計（AND/OR/NOT 三選項）

#### 最終驗收
- [ ] 所有微調功能測試驗證
- [ ] 視覺細節檢查
- [ ] 鍵盤交互測試
- [ ] 鼠標交互測試

---

## 問題記錄 (Issues Log)

### 已解決的問題

| 問題 ID | 修復日期 | 類別 | 狀態 |
| :--- | :--- | :--- | :--- |
| **CODE-001** | 2025-10-23 | TypeScript 診斷 | ✅ 已修復 |
| 移除未使用的參數 `inputElement` | | | |
| **CODE-002** | 2025-10-23 | TypeScript 診斷 | ✅ 已修復 |
| 移除未使用的參數 `index` | | | |
| **CODE-003** | 2025-10-23 | 功能完善 | ✅ 已修復 |
| 為左側建議列表添加 ghost suggestion | | | |

---
